{
  "apiVersion": "frameworkcontroller.microsoft.com/v1",
  "kind": "Framework",
  "metadata": {
    "annotations": {
      "config": "protocolVersion: 2\nname: test-user_68fc014c\ntype: job\njobRetryCount: 0\nprerequisites:\n  - type: dockerimage\n    uri: 'openpai/standard:python_3.6-pytorch_1.2.0-gpu'\n    name: docker_image_0\ntaskRoles:\n  taskrole:\n    instances: 2\n    completion:\n      minFailedInstances: 1\n      minSucceededInstances: -1\n    taskRetryCount: 0\n    dockerImage: docker_image_0\n    resourcePerInstance:\n      gpu: 1\n      cpu: 4\n      memoryMB: 8192\n      ports:\n        tpc: 10\n        udp: 10\n    commands:\n      - printenv\ndefaults:\n  virtualCluster: default\nextras:\n  com.microsoft.pai.runtimeplugin:\n    - plugin: ssh\n      parameters:\n        jobssh: true\n",
      "jobName": "test-user_68fc014c",
      "logPathInfix": "7a11e02ca4104f0f9f0118fdda6ba83a",
      "totalGpuNumber": "2"
    },
    "creationTimestamp": "2020-05-15T08:17:42Z",
    "generation": 19,
    "labels": {
      "userName": "test-user",
      "virtualCluster": "default"
    },
    "name": "7a11e02ca4104f0f9f0118fdda6ba83a",
    "namespace": "default",
    "resourceVersion": "47389628",
    "selfLink": "/apis/frameworkcontroller.microsoft.com/v1/namespaces/default/frameworks/7a11e02ca4104f0f9f0118fdda6ba83a",
    "uid": "8c8c945b-9684-11ea-830b-000d3ab25bb6"
  },
  "spec": {
    "description": "",
    "executionType": "Start",
    "retryPolicy": {
      "fancyRetryPolicy": true,
      "maxRetryCount": 0
    },
    "taskRoles": [
      {
        "frameworkAttemptCompletionPolicy": {
          "minFailedTaskCount": 1,
          "minSucceededTaskCount": -1
        },
        "name": "taskrole",
        "task": {
          "pod": {
            "metadata": {
              "annotations": {
                "container.apparmor.security.beta.kubernetes.io/app": "unconfined",
                "rest-server/port-scheduling-spec": "{\"schedulePortStart\":20000,\"schedulePortEnd\":40000,\"ports\":{\"tpc\":{\"count\":10},\"udp\":{\"count\":10},\"ssh\":{\"count\":1},\"http\":{\"count\":1}}}"
              },
              "creationTimestamp": null,
              "labels": {
                "type": "kube-launcher-task",
                "userName": "test-user",
                "virtualCluster": "default"
              }
            },
            "spec": {
              "affinity": {
                "nodeAffinity": {
                  "requiredDuringSchedulingIgnoredDuringExecution": {
                    "nodeSelectorTerms": [
                      {
                        "matchExpressions": [
                          {
                            "key": "pai-worker",
                            "operator": "In",
                            "values": ["true"]
                          }
                        ]
                      }
                    ]
                  }
                }
              },
              "containers": [
                {
                  "command": ["/usr/local/pai/runtime"],
                  "env": [
                    {
                      "name": "PAI_FRAMEWORK_NAME",
                      "value": "test-user~test-user_68fc014c"
                    },
                    {
                      "name": "PAI_JOB_NAME",
                      "value": "test-user~test-user_68fc014c"
                    },
                    {
                      "name": "PAI_USER_NAME",
                      "value": "test-user"
                    },
                    {
                      "name": "PAI_DEFAULT_FS_URI"
                    },
                    {
                      "name": "PAI_TASK_ROLE_COUNT",
                      "value": "1"
                    },
                    {
                      "name": "PAI_TASK_ROLE_LIST",
                      "value": "taskrole"
                    },
                    {
                      "name": "PAI_TASK_ROLE_TASK_COUNT_taskrole",
                      "value": "2"
                    },
                    {
                      "name": "PAI_RESOURCE_taskrole",
                      "value": "1,4,8192,0"
                    },
                    {
                      "name": "PAI_MIN_FAILED_TASK_COUNT_taskrole",
                      "value": "1"
                    },
                    {
                      "name": "PAI_MIN_SUCCEEDED_TASK_COUNT_taskrole",
                      "value": "-1"
                    },
                    {
                      "name": "PAI_USERNAME",
                      "value": "test-user"
                    },
                    {
                      "name": "PAI_TASKS_NUM",
                      "value": "2"
                    },
                    {
                      "name": "PAI_JOB_TASK_COUNT",
                      "value": "2"
                    },
                    {
                      "name": "PAI_TASK_ROLES_NUM",
                      "value": "1"
                    },
                    {
                      "name": "PAI_JOB_TASK_ROLE_COUNT",
                      "value": "1"
                    },
                    {
                      "name": "PAI_JOB_TASK_ROLE_LIST",
                      "value": "taskrole"
                    },
                    {
                      "name": "PAI_CURRENT_TASK_ROLE_NAME",
                      "value": "taskrole"
                    },
                    {
                      "name": "PAI_CURRENT_TASK_ROLE_CURRENT_TASK_INDEX",
                      "valueFrom": {
                        "fieldRef": {
                          "fieldPath": "metadata.annotations['FC_TASK_INDEX']"
                        }
                      }
                    },
                    {
                      "name": "PAI_TASK_INDEX",
                      "valueFrom": {
                        "fieldRef": {
                          "fieldPath": "metadata.annotations['FC_TASK_INDEX']"
                        }
                      }
                    }
                  ],
                  "image": "openpai/standard:python_3.6-pytorch_1.2.0-gpu",
                  "imagePullPolicy": "Always",
                  "name": "app",
                  "resources": {
                    "limits": {
                      "cpu": "4",
                      "github.com/fuse": "1",
                      "memory": "8Gi",
                      "nvidia.com/gpu": "1"
                    }
                  },
                  "securityContext": {
                    "capabilities": {
                      "add": ["SYS_ADMIN", "IPC_LOCK", "DAC_READ_SEARCH"],
                      "drop": ["MKNOD"]
                    }
                  },
                  "terminationMessagePath": "/tmp/pai-termination-log",
                  "volumeMounts": [
                    {
                      "mountPath": "/dev/shm",
                      "name": "dshm"
                    },
                    {
                      "mountPath": "/usr/local/pai",
                      "name": "pai-vol"
                    },
                    {
                      "mountPath": "/usr/local/pai/logs",
                      "name": "host-log",
                      "subPath": "test-user/7a11e02ca4104f0f9f0118fdda6ba83a/taskrole"
                    },
                    {
                      "mountPath": "/usr/local/pai/ssh-secret",
                      "name": "job-ssh-secret-volume",
                      "readOnly": true
                    }
                  ]
                }
              ],
              "hostNetwork": true,
              "imagePullSecrets": [
                {
                  "name": "pai-secret"
                }
              ],
              "initContainers": [
                {
                  "env": [
                    {
                      "name": "USER_CMD",
                      "value": "printenv"
                    },
                    {
                      "name": "KUBE_APISERVER_ADDRESS",
                      "value": "http://10.151.40.4:8080"
                    },
                    {
                      "name": "GANG_ALLOCATION",
                      "value": "true"
                    },
                    {
                      "name": "PAI_FRAMEWORK_NAME",
                      "value": "test-user~test-user_68fc014c"
                    },
                    {
                      "name": "PAI_JOB_NAME",
                      "value": "test-user~test-user_68fc014c"
                    },
                    {
                      "name": "PAI_USER_NAME",
                      "value": "test-user"
                    },
                    {
                      "name": "PAI_DEFAULT_FS_URI"
                    },
                    {
                      "name": "PAI_TASK_ROLE_COUNT",
                      "value": "1"
                    },
                    {
                      "name": "PAI_TASK_ROLE_LIST",
                      "value": "taskrole"
                    },
                    {
                      "name": "PAI_TASK_ROLE_TASK_COUNT_taskrole",
                      "value": "2"
                    },
                    {
                      "name": "PAI_RESOURCE_taskrole",
                      "value": "1,4,8192,0"
                    },
                    {
                      "name": "PAI_MIN_FAILED_TASK_COUNT_taskrole",
                      "value": "1"
                    },
                    {
                      "name": "PAI_MIN_SUCCEEDED_TASK_COUNT_taskrole",
                      "value": "-1"
                    },
                    {
                      "name": "PAI_USERNAME",
                      "value": "test-user"
                    },
                    {
                      "name": "PAI_TASKS_NUM",
                      "value": "2"
                    },
                    {
                      "name": "PAI_JOB_TASK_COUNT",
                      "value": "2"
                    },
                    {
                      "name": "PAI_TASK_ROLES_NUM",
                      "value": "1"
                    },
                    {
                      "name": "PAI_JOB_TASK_ROLE_COUNT",
                      "value": "1"
                    },
                    {
                      "name": "PAI_JOB_TASK_ROLE_LIST",
                      "value": "taskrole"
                    },
                    {
                      "name": "PAI_CURRENT_TASK_ROLE_NAME",
                      "value": "taskrole"
                    },
                    {
                      "name": "PAI_CURRENT_TASK_ROLE_CURRENT_TASK_INDEX",
                      "valueFrom": {
                        "fieldRef": {
                          "fieldPath": "metadata.annotations['FC_TASK_INDEX']"
                        }
                      }
                    }
                  ],
                  "image": "openpai/openpai-runtime:test-user",
                  "imagePullPolicy": "Always",
                  "name": "init",
                  "resources": {},
                  "volumeMounts": [
                    {
                      "mountPath": "/usr/local/pai",
                      "name": "pai-vol"
                    },
                    {
                      "mountPath": "/usr/local/pai/logs",
                      "name": "host-log",
                      "subPath": "test-user/7a11e02ca4104f0f9f0118fdda6ba83a/taskrole"
                    },
                    {
                      "mountPath": "/usr/local/pai-config",
                      "name": "job-exit-spec"
                    }
                  ]
                }
              ],
              "priorityClassName": "7a11e02ca4104f0f9f0118fdda6ba83a-priority",
              "restartPolicy": "Never",
              "serviceAccountName": "runtime-account",
              "volumes": [
                {
                  "emptyDir": {
                    "medium": "Memory",
                    "sizeLimit": "512Mi"
                  },
                  "name": "dshm"
                },
                {
                  "emptyDir": {},
                  "name": "pai-vol"
                },
                {
                  "hostPath": {
                    "path": "/var/log/pai"
                  },
                  "name": "host-log"
                },
                {
                  "name": "job-ssh-secret-volume",
                  "secret": {
                    "secretName": "job-ssh-secret"
                  }
                },
                {
                  "configMap": {
                    "name": "runtime-exit-spec-configuration"
                  },
                  "name": "job-exit-spec"
                }
              ]
            }
          },
          "podGracefulDeletionTimeoutSec": 1800,
          "retryPolicy": {
            "fancyRetryPolicy": false,
            "maxRetryCount": 0
          }
        },
        "taskNumber": 2
      }
    ]
  },
  "status": {
    "attemptStatus": {
      "completionStatus": {
        "code": 0,
        "diagnostics": "Pod succeeded",
        "phrase": "Succeeded",
        "trigger": {
          "message": "All Tasks are completed and no user specified conditions in FrameworkAttemptCompletionPolicy have ever been triggered: TotalTaskCount: 2, FailedTaskCount: 0",
          "taskIndex": 0,
          "taskRoleName": "taskrole"
        },
        "type": {
          "attributes": [],
          "name": "Succeeded"
        }
      },
      "completionTime": "2020-05-15T08:17:55Z",
      "configMapName": "7a11e02ca4104f0f9f0118fdda6ba83a-attempt",
      "configMapUID": "8c91f63f-9684-11ea-830b-000d3ab25bb6",
      "id": 0,
      "instanceUID": "0_8c91f63f-9684-11ea-830b-000d3ab25bb6",
      "runTime": "2020-05-15T08:17:53Z",
      "startTime": "2020-05-15T08:17:42Z",
      "taskRoleStatuses": [
        {
          "name": "taskrole",
          "taskStatuses": [
            {
              "attemptStatus": {
                "completionStatus": {
                  "code": 0,
                  "diagnostics": "Pod succeeded",
                  "phrase": "Succeeded",
                  "pod": {
                    "containers": [
                      {
                        "code": 0,
                        "name": "init",
                        "reason": "Completed"
                      },
                      {
                        "code": 0,
                        "name": "app",
                        "reason": "Completed"
                      }
                    ]
                  },
                  "type": {
                    "attributes": [],
                    "name": "Succeeded"
                  }
                },
                "completionTime": "2020-05-15T08:17:55Z",
                "id": 0,
                "instanceUID": "0_8c9b72bf-9684-11ea-830b-000d3ab25bb6",
                "podHostIP": "10.151.41.9",
                "podIP": "10.151.41.9",
                "podName": "7a11e02ca4104f0f9f0118fdda6ba83a-taskrole-0",
                "podNodeName": "10.151.41.9",
                "podUID": "8c9b72bf-9684-11ea-830b-000d3ab25bb6",
                "runTime": "2020-05-15T08:17:53Z",
                "startTime": "2020-05-15T08:17:42Z"
              },
              "completionTime": "2020-05-15T08:17:55Z",
              "index": 0,
              "retryPolicyStatus": {
                "accountableRetriedCount": 0,
                "retryDelaySec": null,
                "totalRetriedCount": 0
              },
              "startTime": "2020-05-15T08:17:42Z",
              "state": "Completed",
              "transitionTime": "2020-05-15T08:17:55Z"
            },
            {
              "attemptStatus": {
                "completionStatus": {
                  "code": 0,
                  "diagnostics": "Pod succeeded",
                  "phrase": "Succeeded",
                  "pod": {
                    "containers": [
                      {
                        "code": 0,
                        "name": "init",
                        "reason": "Completed"
                      },
                      {
                        "code": 0,
                        "name": "app",
                        "reason": "Completed"
                      }
                    ]
                  },
                  "type": {
                    "attributes": [],
                    "name": "Succeeded"
                  }
                },
                "completionTime": "2020-05-15T08:17:54Z",
                "id": 0,
                "instanceUID": "0_8c9be76b-9684-11ea-830b-000d3ab25bb6",
                "podHostIP": "10.151.40.6",
                "podIP": "10.151.40.6",
                "podName": "7a11e02ca4104f0f9f0118fdda6ba83a-taskrole-1",
                "podNodeName": "10.151.40.6",
                "podUID": "8c9be76b-9684-11ea-830b-000d3ab25bb6",
                "runTime": "2020-05-15T08:17:53Z",
                "startTime": "2020-05-15T08:17:42Z"
              },
              "completionTime": "2020-05-15T08:17:54Z",
              "index": 1,
              "retryPolicyStatus": {
                "accountableRetriedCount": 0,
                "retryDelaySec": null,
                "totalRetriedCount": 0
              },
              "startTime": "2020-05-15T08:17:42Z",
              "state": "Completed",
              "transitionTime": "2020-05-15T08:17:54Z"
            }
          ]
        }
      ]
    },
    "completionTime": "2020-05-15T08:17:56Z",
    "retryPolicyStatus": {
      "accountableRetriedCount": 0,
      "retryDelaySec": null,
      "totalRetriedCount": 0
    },
    "startTime": "2020-05-15T08:17:42Z",
    "state": "Completed",
    "transitionTime": "2020-05-15T08:17:56Z"
  }
}
